<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-compiatable" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="ttalogo.png" type="image/png" sizes="16x16">
<title>Time Tracker</title>
<link rel="stylesheet" type="text/css" href="time_tracker.css">
<link rel="stylesheet" type="text/css" href="bootstrap.css">
<script type= "text/javascript" src="https://autocode.pythonanywhere.com/AAT/static/jquery-1.11.2.min.js"></script>
</head>
<body onload="fourl()"  style="background-color:gray">
	<div class="container-fluid">

		<div class="row row1">
			<div class="col-md-12">
				<div class="page-header">
					<img class="image1" src="TTA.png" alt="logo" type="image/png" width="75px">
					<h1><em>TARA Mobile Technologies</em></h1>
				</div>
			</div>
		</div>
        <div class="bars">
            <select class="form-control" id="yearMonthInput"></select>
        </div>
		<div class="row row2">			
			<div class="col-md-3" style="padding-right: 20px;">
				<div class="container-fluid container2">
					<div class="row">
						<form class="form-search searchbar">
  						<input type="text" class="input-medium search-query">
  						<button type="submit" id="" class="btn">Search</button>
						</form>
<br>
<div>
	<p id="employeebar"></p>
</div>
<script type="text/javascript">
document.write('<table class="table-hover table1"border="0px"; style="width:100%">');
document.write('<thead class="tablehead" style="text-align:right">');
document.write('<tr><th style="text-align: center; width="65%">Employee Name</th><th style="text-align: center;">Duration</th></tr>');
document.write('</thead>');
document.write('</table>');
document.write('<table id="table23" class="table-hover table1"border="1px"; style="width:100%">');
document.write('</table>');
</script>
					</div>
				</div>
			</div>
			<div class="col-md-9">
				<div class="container-fluid container3">
					<div class="row row4">
						<div class="col-md-12 col4">
							<div class="btn-toolbar">
  								<div id="buttonbar" class="btn-group">
<script type="text/javascript">
    function daysInMonth(month,year) {
    return new Date(year, month, 0).getDate();
}
    var m = 2;
    var n = 2014;
    var alldays = daysInMonth(m,n);
    for (var l=1; l<=alldays; l++){
        if (l==1){
        var allbuttons = document.write('<button class="btn" id="'+l+'">'+l+'</button>');
        }else{
        allbuttons = allbuttons + document.write('<button class="btn" id="'+l+'">'+l+'</button>');
        }
               }
    //this is to display button bar
</script>
	  							</div>
							</div>
						</div>	
					</div>
					<div class="row row5">
						<div id="tablespace" class="col-md-8 col5">
<script>
    var arr = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];
    jQuery.each(arr, function( key, value){
    $('.btn').click(function(hello){
        hello.stopPropagation();
     $(this).addClass('active')
    });
        $('#'+value).click(function(){
            $('.active').removeClass('active')
        });
    });
    //code for div disappearing(time in and time out)
     $('#table23').click( function(event){
         event.stopPropagation();
         $('#table123').toggle();
    });

    $('#buttonbar').click( function(){
        $('#table123').hide();
    });
    //code for highlighting employee names
    $('.employeename').click(function(names){
    names.stopPropagation();
        $(this).addClass('active')
    });
    $(document).click(function(){
        $('.active').removeClass('active')
    });
    //to pick year and month
   var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    for (i = new Date().getFullYear() ; i > 2012; i--) {
        $.each(months, function (index, value) {
                $('#yearMonthInput').append($('<option>').html(value + " " + i));
        });
    }
</script>
<script type="text/javascript">
document.write('<table class="table-hover table1"border="0px"; style="width:100%">');
document.write('<thead class="tablehead" style="text-align:right">');
document.write('<tr><th style="text-align: center; width: 287px;">Time In</th><th style="text-align: center;">Time Out</th></tr>');
document.write('</thead>');
document.write('</table>');
document.write('<table id="table123" class="table-hover table1"border="1px"; style="width:100%">');
document.write('</table>');
</script>
						</div>
<div id="mydiv" class="col-md-4"></div>
					</div>
<script>
		var text;
		var object;
		var empname;
		var empname1;
		function funky(i){
			var hours=Math.floor((empname1[i].duration)/3600);
			var minutes=(empname1[i].duration-(hours*3600))/60;
			var id = Math.trunc(hours)+'h '+Math.trunc(minutes)+'m';
			var dd = empname1[i].no_of_days;
			var fd = '<h4 style="color: white";>'+'Duration:'+id+'<br>'+'Days:' +dd+'</h4>';
			function getDetails(empno){
				var j=empno;
				var actual;
				var content="";
				var val;
				for(var i=0;i<empname.length;i++){
					if(empname[i].name==empno){
						actual=empname[i].details;
						for (var j=0; j<actual.length; j++){
							var timein = (((empname[i].details)[j]))[0];
							var timeout = (((empname[i].details)[j]))[1];
							content=content+"<tr><td>"+ timein.slice(11,19) + "</td><td>" + timeout.slice(11,19) +" </td><tr>";
						}
				return document.getElementById("table123").innerHTML=content;
                        }
                }
				return document.getElementById("mydiv").innerHTML=fd;
			}
		var hd = getDetails(empname1[i].name);
		document.getElementById("mydiv").innerHTML=fd;
		}
		function fourl() {
			var httpRequest;
            var urls = []
            for (var k=1; k<=31; k++) {
            	// dynamic generation of URL
            	var url = 'https://autocode.pythonanywhere.com/AAT/reporting/day_summary?date=';
            	// to prefix 0 if the date is less than 10
            	if (k < 10) 
            		url += '0' + k + '-12-14';
            	else
            		url += k + '-12-14';
            urls[k] = url;
               // register the onclick
               document.getElementById(k).onclick = function() {
                   makeRequest(urls[this.id])
               }
            }
        };
			function makeRequest(url) {
				if(window.XMLHttpRequest) {
					httpRequest = new XMLHttpRequest();
				} else if (window.ActiveXObject) {
					try {
						httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
					} catch (e) {
						try {
							httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
						} catch (e) {}
					}
				}
				if (!httpRequest) {
					alert("Giving up :( Cannot create an XMLHTTP instance");
					return false;
				}
				httpRequest.onreadystatechange = daywise;
				httpRequest.open('GET', url);
				httpRequest.send();
			}
			function daywise() {
				try {
				if (httpRequest.readyState === 4) {
					if (httpRequest.status === 200) {
						 text =  httpRequest.responseText;
						 object = JSON.parse(text);
						 empname = (object.day);
						 empname1 = (object.month);
						for (var i=0; i<empname.length; i++){
												var hours=Math.floor((empname[i].duration)/3600);
												var minutes=(empname[i].duration-(hours*3600))/60;
												var result = Math.trunc(hours)+'h '+Math.trunc(minutes)+'m';
												if (i==0){

                                                    var atlast='<tr><td style="width:68%"><button type="button" id="employeename" class="btn btn-block" onclick=funky('+i+')>' + empname[i].name + '</button></td>'+'<td>' + result + '</td></tr>';
												alert("double click on Employee name");
}else{
												atlast = atlast+'<tr><td style="width:68%"><button type="button" id="employeename" class="btn btn-block" onclick = funky('+i+')>' + empname[i].name + '</button></td>'+'<td>' + result + '</td></tr>';
												}
											}
										 document.getElementById("table23").innerHTML=atlast;
										}
											else {
						alert("There was a problem with the request.");
					}
				}
			}
			 catch( e ) {
    alert('Caught Exception: ' + e.description);
  }
}
</script>
				</div>
			</div>
		</div>
	</div>

</body>
</html>
